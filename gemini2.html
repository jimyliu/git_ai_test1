<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Image Frame Tool â€” 2025-12-30 19:49:15</title>
    <style>
        :root {
            --bg-color: #f4f4f7;
            --panel-bg: #ffffff;
            --text-color: #333333;
            --accent-color: #007aff;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-ui);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        header {
            background: var(--panel-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            z-index: 10;
        }

        h1 {
            font-size: 18px;
            margin: 0;
            font-weight: 600;
        }

        .version-tag {
            font-size: 12px;
            color: #888;
            font-family: monospace;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .canvas-area {
            flex: 1;
            background-color: #e5e5e5;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: auto;
            background-image: radial-gradient(#ccc 1px, transparent 1px);
            background-size: 20px 20px;
        }

        canvas {
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 100%;
            max-height: 100%;
            cursor: move;
            touch-action: none; 
        }

        .controls {
            width: 340px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            padding-bottom: 40px;
        }

        .control-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .control-section h3 {
            margin: 0 0 15px 0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #666;
        }

        .input-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 100%;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            padding: 0;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
        }

        input[type="number"] {
            width: 60px;
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }

        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-secondary {
            background-color: #f0f0f5;
            color: #333;
        }

        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-upload-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }

        .hint {
            font-size: 11px;
            color: #888;
            margin-top: 4px;
        }

        @media (max-width: 768px) {
            .main-container { flex-direction: column; }
            .canvas-area { height: 50vh; }
            .controls { width: 100%; height: auto; border-left: none; border-top: 1px solid var(--border-color); }
        }
    </style>
</head>
<body>

<header>
    <div>
        <h1>AI Image Frame Tool</h1>
        <span class="version-tag">2025-12-30 19:49:15</span>
    </div>
</header>

<div class="main-container">
    <div class="canvas-area">
        <canvas id="mainCanvas"></canvas>
    </div>

    <div class="controls">
        <div class="control-section">
            <h3>1. Main Photo & Inner Frame</h3>
            <div class="input-group">
                <div class="file-upload-wrapper">
                    <button class="btn btn-primary">ðŸ“‚ Upload Photo</button>
                    <input type="file" id="imageUpload" accept="image/*">
                </div>
                <div class="hint">Click and drag photo to move it.</div>
            </div>
            
            <div class="input-group">
                <label>Photo Scaling</label>
                <div class="slider-group">
                    <input type="range" id="photoScale" min="10" max="200" value="70">
                    <input type="number" id="photoScaleNum" value="70" min="10" max="200">
                </div>
            </div>

            <div class="input-group">
                <label>Inner Frame Color</label>
                <input type="color" id="frameColor" value="#ffffff">
            </div>

            <div class="input-group">
                <label>Inner Frame Thickness</label>
                <div class="slider-group">
                    <input type="range" id="frameWidth" min="0" max="200" value="40">
                    <input type="number" id="frameWidthNum" value="40" min="0" max="200">
                </div>
            </div>
        </div>

        <div class="control-section">
            <h3>2. Background Layer</h3>
            <div class="input-group">
                <div class="file-upload-wrapper">
                    <button class="btn btn-secondary">ðŸ–¼ Upload Background</button>
                    <input type="file" id="bgUpload" accept="image/*">
                </div>
            </div>
            <div class="input-group">
                <label>Fallback Color</label>
                <input type="color" id="bgColor" value="#f0f0f0">
            </div>
        </div>

        <div class="control-section">
            <h3>3. Title</h3>
            <div class="input-group"><input type="text" id="titleText" value="Christmas Magic"></div>
            <div class="input-group">
                <select id="titleFont">
                    <option value="'PingFang TC', sans-serif">PingFang TC</option>
                    <option value="'Songti TC', serif">Songti TC</option>
                    <option value="Arial">Arial</option>
                </select>
            </div>
            <div class="input-group">
                <div class="slider-group">
                    <input type="range" id="titleSize" min="14" max="500" value="80">
                    <input type="number" id="titleSizeNum" value="80">
                </div>
            </div>
            <input type="color" id="titleColor" value="#000000">
        </div>

        <div class="control-section">
            <h3>4. Subtitle</h3>
            <div class="input-group"><input type="text" id="subtitleText" value="December 2025"></div>
            <div class="input-group">
                <div class="slider-group">
                    <input type="range" id="subtitleSize" min="14" max="300" value="32">
                    <input type="number" id="subtitleSizeNum" value="32">
                </div>
            </div>
            <input type="color" id="subtitleColor" value="#444444">
        </div>

        <div class="control-section">
            <button class="btn btn-secondary" id="btnCenter">ðŸŽ¯ Reset Positions</button>
            <button class="btn btn-primary" id="btnExport">ðŸ“¥ Download PNG</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    
    let state = {
        mainImg: new Image(),
        mainLoaded: false,
        bgImg: new Image(),
        bgLoaded: false,
        bgColor: '#f0f0f0',
        
        // Photo State (Location + Frame)
        photo: { x: 600, y: 400, scale: 70, frameWidth: 40, frameColor: '#ffffff' },
        
        title: { text: 'Christmas Magic', font: "'PingFang TC', sans-serif", size: 80, color: '#000000', x: 600, y: 650 },
        subtitle: { text: 'December 2025', font: "'PingFang TC', sans-serif", size: 32, color: '#444444', x: 600, y: 720 }
    };

    function init() {
        canvas.width = 1200;
        canvas.height = 800;
        draw();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. Background
        if (state.bgLoaded) {
            ctx.drawImage(state.bgImg, 0, 0, canvas.width, canvas.height);
        } else {
            ctx.fillStyle = state.bgColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        if (state.mainLoaded) {
            const p = state.photo;
            const aspect = state.mainImg.width / state.mainImg.height;
            // Target width based on canvas width and scale %
            const targetW = (canvas.width * (p.scale / 100));
            const targetH = targetW / aspect;

            // 2. Draw Frame (The "Boarder")
            const fw = parseInt(p.frameWidth);
            if (fw > 0) {
                ctx.fillStyle = p.frameColor;
                ctx.fillRect(p.x - (targetW/2) - fw, p.y - (targetH/2) - fw, targetW + (fw*2), targetH + (fw*2));
            }

            // 3. Draw Main Image
            ctx.drawImage(state.mainImg, p.x - (targetW/2), p.y - (targetH/2), targetW, targetH);
        } else {
            ctx.fillStyle = "#ccc";
            ctx.textAlign = "center";
            ctx.font = "30px sans-serif";
            ctx.fillText("Upload Photo to Start", canvas.width/2, canvas.height/2);
        }

        // 4. Text Layers
        drawText(state.title);
        drawText(state.subtitle);
    }

    function drawText(obj) {
        ctx.save();
        ctx.fillStyle = obj.color;
        ctx.font = `${obj.size}px ${obj.font}`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(obj.text, obj.x, obj.y);
        ctx.restore();
    }

    // --- Interaction Logic ---
    let dragTarget = null;
    let offset = { x: 0, y: 0 };

    function getCoords(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return {
            x: (clientX - rect.left) * (canvas.width / rect.width),
            y: (clientY - rect.top) * (canvas.height / rect.height)
        };
    }

    function isHit(obj, x, y, type) {
        if (type === 'photo') {
            if (!state.mainLoaded) return false;
            const aspect = state.mainImg.width / state.mainImg.height;
            const w = (canvas.width * (state.photo.scale / 100)) + (state.photo.frameWidth * 2);
            const h = (w / aspect);
            return (x >= obj.x - w/2 && x <= obj.x + w/2 && y >= obj.y - h/2 && y <= obj.y + h/2);
        } else {
            ctx.font = `${obj.size}px ${obj.font}`;
            const tw = ctx.measureText(obj.text).width;
            const th = obj.size;
            return (x >= obj.x - tw/2 && x <= obj.x + tw/2 && y >= obj.y - th/2 && y <= obj.y + th/2);
        }
    }

    function startDrag(e) {
        const { x, y } = getCoords(e);
        if (isHit(state.subtitle, x, y, 'text')) dragTarget = state.subtitle;
        else if (isHit(state.title, x, y, 'text')) dragTarget = state.title;
        else if (isHit(state.photo, x, y, 'photo')) dragTarget = state.photo;

        if (dragTarget) {
            offset.x = x - dragTarget.x;
            offset.y = y - dragTarget.y;
        }
    }

    function doDrag(e) {
        if (!dragTarget) return;
        e.preventDefault();
        const { x, y } = getCoords(e);
        dragTarget.x = x - offset.x;
        dragTarget.y = y - offset.y;
        draw();
    }

    canvas.addEventListener('mousedown', startDrag);
    window.addEventListener('mousemove', doDrag);
    window.addEventListener('mouseup', () => dragTarget = null);
    canvas.addEventListener('touchstart', startDrag, {passive:false});
    window.addEventListener('touchmove', doDrag, {passive:false});
    window.addEventListener('touchend', () => dragTarget = null);

    // --- Controls Listeners ---
    document.getElementById('imageUpload').addEventListener('change', (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            state.mainImg.onload = () => { state.mainLoaded = true; draw(); };
            state.mainImg.src = ev.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    document.getElementById('bgUpload').addEventListener('change', (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            state.bgImg.onload = () => { state.bgLoaded = true; draw(); };
            state.bgImg.src = ev.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    const bind = (id, obj, prop, isNum = false) => {
        const el = document.getElementById(id);
        el.addEventListener('input', (e) => {
            obj[prop] = isNum ? parseFloat(e.target.value) : e.target.value;
            // Sync slider/number pairs
            if (id.includes('Scale') || id.includes('Width') || id.includes('Size')) {
                const partner = id.endsWith('Num') ? id.replace('Num', '') : id + 'Num';
                const pEl = document.getElementById(partner);
                if (pEl) pEl.value = e.target.value;
            }
            draw();
        });
    };

    bind('photoScale', state.photo, 'scale', true);
    bind('photoScaleNum', state.photo, 'scale', true);
    bind('frameWidth', state.photo, 'frameWidth', true);
    bind('frameWidthNum', state.photo, 'frameWidth', true);
    bind('frameColor', state.photo, 'frameColor');
    bind('bgColor', state, 'bgColor');
    bind('titleText', state.title, 'text');
    bind('titleSize', state.title, 'size', true);
    bind('titleSizeNum', state.title, 'size', true);
    bind('titleColor', state.title, 'color');
    bind('subtitleText', state.subtitle, 'text');
    bind('subtitleSize', state.subtitle, 'size', true);
    bind('subtitleSizeNum', state.subtitle, 'size', true);
    bind('subtitleColor', state.subtitle, 'color');

    document.getElementById('btnCenter').addEventListener('click', () => {
        state.photo.x = 600; state.photo.y = 400;
        state.title.x = 600; state.title.y = 650;
        state.subtitle.x = 600; state.subtitle.y = 720;
        draw();
    });

    document.getElementById('btnExport').addEventListener('click', () => {
        const link = document.createElement('a');
        link.download = `framed-photo-${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
    });

    init();
</script>
</body>
</html>
