<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Image Frame Tool â€” Transparancy Support</title>
    <style>
        :root {
            --bg-color: #f4f4f7;
            --panel-bg: #ffffff;
            --text-color: #333333;
            --accent-color: #007aff;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-ui);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        header {
            background: var(--panel-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            z-index: 10;
        }

        h1 { font-size: 18px; margin: 0; font-weight: 600; }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .canvas-area {
            flex: 1;
            background-color: #e5e5e5;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: auto;
            background-image: radial-gradient(#ccc 1px, transparent 1px);
            background-size: 20px 20px;
        }

        canvas {
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 100%;
            max-height: 100%;
            cursor: move;
            touch-action: none; 
        }

        .controls {
            width: 340px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            padding-bottom: 40px;
        }

        .control-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .control-section h3 {
            margin: 0 0 15px 0;
            font-size: 13px;
            text-transform: uppercase;
            color: #666;
        }

        .input-group { margin-bottom: 12px; }

        label { display: block; font-size: 13px; margin-bottom: 5px; font-weight: 500; }

        input[type="text"], select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }

        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 100%;
            height: 30px;
            border-radius: 4px;
            cursor: pointer;
        }

        .slider-group { display: flex; align-items: center; gap: 10px; }
        input[type="range"] { flex: 1; }
        input[type="number"] { width: 55px; padding: 4px; border: 1px solid #ccc; border-radius: 4px; }

        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .btn-primary { background-color: var(--accent-color); color: white; }
        .btn-secondary { background-color: #f0f0f5; color: #333; }

        .file-upload-wrapper { position: relative; overflow: hidden; display: inline-block; width: 100%; }
        .file-upload-wrapper input[type=file] {
            font-size: 100px; position: absolute; left: 0; top: 0; opacity: 0; cursor: pointer;
        }

        @media (max-width: 768px) {
            .main-container { flex-direction: column; }
            .canvas-area { height: 40vh; }
            .controls { width: 100%; border-left: none; border-top: 1px solid var(--border-color); }
        }
    </style>
</head>
<body>

<header>
    <h1>AI Image Frame Tool</h1>
</header>

<div class="main-container">
    <div class="canvas-area">
        <canvas id="mainCanvas"></canvas>
    </div>

    <div class="controls">
        <div class="control-section">
            <h3>1. Main Photo & Inner Frame</h3>
            <div class="input-group">
                <div class="file-upload-wrapper">
                    <button class="btn btn-primary">ðŸ“‚ Upload Main Photo</button>
                    <input type="file" id="imageUpload" accept="image/*">
                </div>
            </div>
            
            <div class="input-group">
                <label>Scaling (%)</label>
                <div class="slider-group">
                    <input type="range" id="photoScale" min="10" max="200" value="75">
                    <input type="number" id="photoScaleNum" value="75">
                </div>
            </div>

            <div class="input-group">
                <label>Inner Frame Color</label>
                <input type="color" id="frameColor" value="#ffffff">
            </div>

            <div class="input-group">
                <label>Inner Frame Thickness</label>
                <div class="slider-group">
                    <input type="range" id="frameWidth" min="0" max="150" value="30">
                    <input type="number" id="frameWidthNum" value="30">
                </div>
            </div>
        </div>

        <div class="control-section">
            <h3>2. Background Layer</h3>
            <div class="input-group">
                <div class="file-upload-wrapper">
                    <button class="btn btn-secondary">ðŸŽ„ Upload BG Image</button>
                    <input type="file" id="bgUpload" accept="image/*">
                </div>
            </div>
            
            <div class="input-group">
                <label>BG Image Transparency</label>
                <div class="slider-group">
                    <input type="range" id="bgOpacity" min="20" max="100" value="100">
                    <input type="number" id="bgOpacityNum" value="100">
                </div>
            </div>

            <div class="input-group">
                <label>Canvas Fallback Color</label>
                <input type="color" id="bgColor" value="#f0f0f0">
            </div>
        </div>

        <div class="control-section">
            <h3>3. Title Text</h3>
            <div class="input-group"><input type="text" id="titleText" value="ç¥ è–èª•å¿«æ¨‚"></div>
            <div class="input-group">
                <label>Font (Traditional Chinese)</label>
                <select id="titleFont">
                    <optgroup label="Traditional Chinese">
                        <option value="'PingFang TC', 'PingFangTC-Regular', 'Microsoft JhengHei', sans-serif">PingFang TC (Standard)</option>
                        <option value="'Songti TC', 'STSong', serif">Songti TC (Serif)</option>
                        <option value="'Kaiti TC', 'STKaiti', serif">Kaiti TC (Calligraphy)</option>
                        <option value="'Heiti TC', sans-serif">Heiti TC</option>
                    </optgroup>
                    <optgroup label="System">
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="Georgia, serif">Georgia</option>
                    </optgroup>
                </select>
            </div>
            <div class="input-group">
                <div class="slider-group">
                    <input type="range" id="titleSize" min="10" max="400" value="80">
                    <input type="number" id="titleSizeNum" value="80">
                </div>
            </div>
            <input type="color" id="titleColor" value="#000000">
        </div>

        <div class="control-section">
            <h3>4. Subtitle Text</h3>
            <div class="input-group"><input type="text" id="subtitleText" value="December 2025"></div>
            <div class="input-group">
                <label>Font</label>
                <select id="subtitleFont">
                    <option value="'PingFang TC', 'PingFangTC-Regular', sans-serif">PingFang TC</option>
                    <option value="'Songti TC', serif">Songti TC</option>
                    <option value="'Kaiti TC', serif">Kaiti TC</option>
                    <option value="Arial, sans-serif">Arial</option>
                </select>
            </div>
            <div class="input-group">
                <div class="slider-group">
                    <input type="range" id="subtitleSize" min="10" max="200" value="30">
                    <input type="number" id="subtitleSizeNum" value="30">
                </div>
            </div>
            <input type="color" id="subtitleColor" value="#444444">
        </div>

        <div class="control-section">
            <button class="btn btn-secondary" id="btnCenter">ðŸŽ¯ Reset Positions</button>
            <button class="btn btn-primary" id="btnExport">ðŸ“¥ Download PNG</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    
    let state = {
        mainImg: new Image(),
        mainLoaded: false,
        bgImg: new Image(),
        bgLoaded: false,
        bgColor: '#f0f0f0',
        bgOpacity: 100, // Percentage
        
        photo: { x: 600, y: 350, scale: 75, frameWidth: 30, frameColor: '#ffffff' },
        title: { text: 'ç¥ è–èª•å¿«æ¨‚', font: "'PingFang TC', sans-serif", size: 80, color: '#000000', x: 600, y: 620 },
        subtitle: { text: 'December 2025', font: "'PingFang TC', sans-serif", size: 30, color: '#444444', x: 600, y: 680 }
    };

    function init() {
        canvas.width = 1200;
        canvas.height = 800;
        draw();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. Bottom Canvas Color
        ctx.fillStyle = state.bgColor;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 2. Background Image with Transparency
        if (state.bgLoaded) {
            ctx.save();
            ctx.globalAlpha = state.bgOpacity / 100;
            ctx.drawImage(state.bgImg, 0, 0, canvas.width, canvas.height);
            ctx.restore();
        }

        // 3. Photo & Inner Frame
        if (state.mainLoaded) {
            const p = state.photo;
            const aspect = state.mainImg.width / state.mainImg.height;
            const targetW = (canvas.width * (p.scale / 100));
            const targetH = targetW / aspect;

            const fw = parseInt(p.frameWidth);
            if (fw > 0) {
                ctx.fillStyle = p.frameColor;
                ctx.fillRect(p.x - (targetW/2) - fw, p.y - (targetH/2) - fw, targetW + (fw*2), targetH + (fw*2));
            }
            ctx.drawImage(state.mainImg, p.x - (targetW/2), p.y - (targetH/2), targetW, targetH);
        } else {
            ctx.fillStyle = "#aaa";
            ctx.font = "24px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText("Please upload a Main Photo", canvas.width/2, canvas.height/2);
        }

        // 4. Text Layers
        drawText(state.title);
        drawText(state.subtitle);
    }

    function drawText(obj) {
        ctx.save();
        ctx.fillStyle = obj.color;
        ctx.font = `${obj.size}px ${obj.font}`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(obj.text, obj.x, obj.y);
        ctx.restore();
    }

    // Interaction (Dragging)
    let dragTarget = null;
    let offset = { x: 0, y: 0 };

    function getCoords(e) {
        const rect = canvas.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return {
            x: (clientX - rect.left) * (canvas.width / rect.width),
            y: (clientY - rect.top) * (canvas.height / rect.height)
        };
    }

    function isHit(obj, x, y, type) {
        if (type === 'photo') {
            if (!state.mainLoaded) return false;
            const aspect = state.mainImg.width / state.mainImg.height;
            const w = (canvas.width * (state.photo.scale / 100)) + (state.photo.frameWidth * 2);
            const h = (w / aspect);
            return (x >= obj.x - w/2 && x <= obj.x + w/2 && y >= obj.y - h/2 && y <= obj.y + h/2);
        } else {
            ctx.font = `${obj.size}px ${obj.font}`;
            const tw = ctx.measureText(obj.text).width;
            return (x >= obj.x - tw/2 && x <= obj.x + tw/2 && y >= obj.y - obj.size/2 && y <= obj.y + obj.size/2);
        }
    }

    canvas.addEventListener('mousedown', (e) => {
        const { x, y } = getCoords(e);
        if (isHit(state.subtitle, x, y, 'text')) dragTarget = state.subtitle;
        else if (isHit(state.title, x, y, 'text')) dragTarget = state.title;
        else if (isHit(state.photo, x, y, 'photo')) dragTarget = state.photo;
        if (dragTarget) { offset.x = x - dragTarget.x; offset.y = y - dragTarget.y; }
    });

    window.addEventListener('mousemove', (e) => {
        if (!dragTarget) return;
        const { x, y } = getCoords(e);
        dragTarget.x = x - offset.x; dragTarget.y = y - offset.y;
        draw();
    });

    window.addEventListener('mouseup', () => dragTarget = null);

    // Inputs & Bindings
    document.getElementById('imageUpload').addEventListener('change', (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            state.mainImg.onload = () => { state.mainLoaded = true; draw(); };
            state.mainImg.src = ev.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    document.getElementById('bgUpload').addEventListener('change', (e) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
            state.bgImg.onload = () => { state.bgLoaded = true; draw(); };
            state.bgImg.src = ev.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    function bind(id, obj, prop, isNum = false) {
        const el = document.getElementById(id);
        el.addEventListener('input', (e) => {
            obj[prop] = isNum ? parseFloat(e.target.value) : e.target.value;
            const partnerId = id.endsWith('Num') ? id.replace('Num', '') : id + 'Num';
            const partner = document.getElementById(partnerId);
            if (partner) partner.value = e.target.value;
            draw();
        });
    }

    bind('photoScale', state.photo, 'scale', true);
    bind('photoScaleNum', state.photo, 'scale', true);
    bind('frameWidth', state.photo, 'frameWidth', true);
    bind('frameWidthNum', state.photo, 'frameWidth', true);
    bind('frameColor', state.photo, 'frameColor');
    
    bind('bgOpacity', state, 'bgOpacity', true);
    bind('bgOpacityNum', state, 'bgOpacity', true);
    bind('bgColor', state, 'bgColor');
    
    bind('titleText', state.title, 'text');
    bind('titleFont', state.title, 'font');
    bind('titleSize', state.title, 'size', true);
    bind('titleSizeNum', state.title, 'size', true);
    bind('titleColor', state.title, 'color');
    
    bind('subtitleText', state.subtitle, 'text');
    bind('subtitleFont', state.subtitle, 'font');
    bind('subtitleSize', state.subtitle, 'size', true);
    bind('subtitleSizeNum', state.subtitle, 'size', true);
    bind('subtitleColor', state.subtitle, 'color');

    document.getElementById('btnCenter').addEventListener('click', () => {
        state.photo.x = 600; state.photo.y = 350;
        state.title.x = 600; state.title.y = 620;
        state.subtitle.x = 600; state.subtitle.y = 680;
        draw();
    });

    document.getElementById('btnExport').addEventListener('click', () => {
        const link = document.createElement('a');
        link.download = `photo-art-${Date.now()}.png`;
        link.href = canvas.toDataURL();
        link.click();
    });

    init();
</script>
</body>
</html>
