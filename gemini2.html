<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Image Frame Tool ‚Äî 2025-12-30 19:45:22</title>
    <style>
        :root {
            --bg-color: #f4f4f7;
            --panel-bg: #ffffff;
            --text-color: #333333;
            --accent-color: #007aff;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-ui);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        header {
            background: var(--panel-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            z-index: 10;
        }

        h1 {
            font-size: 18px;
            margin: 0;
            font-weight: 600;
            color: var(--text-color);
        }

        .version-tag {
            font-size: 12px;
            color: #888;
            font-family: monospace;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Canvas Area */
        .canvas-area {
            flex: 1;
            background-color: #e5e5e5;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: auto;
            background-image: radial-gradient(#ccc 1px, transparent 1px);
            background-size: 20px 20px;
        }

        canvas {
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 100%;
            max-height: 100%;
            cursor: crosshair;
            touch-action: none; 
        }

        /* Controls Sidebar */
        .controls {
            width: 340px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            padding-bottom: 40px;
        }

        .control-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .control-section h3 {
            margin: 0 0 15px 0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #666;
        }

        /* Form Elements */
        .input-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
            font-family: var(--font-ui);
        }

        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 100%;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            padding: 0;
            overflow: hidden;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            accent-color: var(--accent-color);
        }

        input[type="number"] {
            width: 60px;
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 8px;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: #0066d6;
        }

        .btn-secondary {
            background-color: #f0f0f5;
            color: #333;
        }
        .btn-secondary:hover {
            background-color: #e0e0e5;
        }

        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-upload-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                height: auto;
                overflow-y: auto;
            }
            .main-container {
                flex-direction: column;
            }
            .canvas-area {
                height: 50vh;
                min-height: 300px;
                order: 1;
            }
            .controls {
                width: 100%;
                height: auto;
                order: 2;
                border-left: none;
                border-top: 1px solid var(--border-color);
            }
        }

        optgroup { font-style: normal; font-weight: bold; color: #666; }
        option { color: #000; }
        
        .divider {
            height: 1px;
            background: #eee;
            margin: 15px 0;
        }
    </style>
</head>
<body>

<header>
    <div>
        <h1>AI Image Frame Tool</h1>
        <span class="version-tag">2025-12-30 19:45:22</span>
    </div>
</header>

<div class="main-container">
    <div class="canvas-area">
        <canvas id="mainCanvas"></canvas>
    </div>

    <div class="controls">
        <div class="control-section">
            <h3>1. Main Photo & Frame</h3>
            <div class="input-group">
                <div class="file-upload-wrapper">
                    <button class="btn btn-primary">üìÇ Upload Main Photo</button>
                    <input type="file" id="imageUpload" accept="image/*">
                </div>
            </div>
            
            <div class="input-group">
                <label>Photo Size (Zoom Out)</label>
                <div class="slider-group">
                    <input type="range" id="photoScale" min="20" max="100" value="85">
                    <input type="number" id="photoScaleNum" value="85" min="20" max="100">
                </div>
                <small style="color:#888; font-size:11px;">Zoom out to see more background.</small>
            </div>

            <div class="divider"></div>

            <div class="input-group">
                <label>Inner Frame Color</label>
                <input type="color" id="frameColor" value="#ffffff">
            </div>

            <div class="input-group">
                <label>Inner Frame Thickness</label>
                <div class="slider-group">
                    <input type="range" id="frameWidth" min="0" max="200" value="30">
                    <input type="number" id="frameWidthNum" value="30" min="0" max="200">
                </div>
            </div>
        </div>

        <div class="control-section">
            <h3>2. Background Layer</h3>
            <div class="input-group">
                <div class="file-upload-wrapper">
                    <button class="btn btn-secondary">üåÑ Upload Background Image</button>
                    <input type="file" id="bgUpload" accept="image/*">
                </div>
            </div>
            
            <div class="input-group">
                <label>Or Background Color</label>
                <input type="color" id="bgColor" value="#e5e5ea">
            </div>
        </div>

        <div class="control-section">
            <h3>3. Title Text</h3>
            <div class="input-group">
                <input type="text" id="titleText" value="Memories">
            </div>
            
            <div class="input-group">
                <label>Font</label>
                <select id="titleFont">
                    <optgroup label="Traditional Chinese - UI/Web">
                        <option value="'PingFang TC', 'PingFangTC-Regular', sans-serif">PingFang TC (Standard)</option>
                        <option value="'PingFangTC-Medium', 'PingFang TC', sans-serif">PingFang TC Medium</option>
                        <option value="'Heiti TC', 'Heiti TC Light', sans-serif">Heiti TC</option>
                    </optgroup>
                    <optgroup label="Traditional Chinese - Serif/Classic">
                        <option value="'Songti TC', 'Songti TC Regular', serif">Songti TC Regular</option>
                        <option value="'Kaiti TC', serif">Kaiti TC (Calligraphy)</option>
                    </optgroup>
                    <optgroup label="Latin / System">
                        <option value="system-ui, -apple-system, sans-serif">System UI</option>
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="Helvetica, sans-serif">Helvetica</option>
                    </optgroup>
                </select>
            </div>

            <div class="input-group">
                <label>Size (pt)</label>
                <div class="slider-group">
                    <input type="range" id="titleSize" min="14" max="800" value="100">
                    <input type="number" id="titleSizeNum" value="100" min="14" max="800">
                </div>
            </div>

            <div class="input-group">
                <label>Color</label>
                <input type="color" id="titleColor" value="#000000">
            </div>
        </div>

        <div class="control-section">
            <h3>4. Subtitle Text</h3>
            <div class="input-group">
                <input type="text" id="subtitleText" value="2025">
            </div>

            <div class="input-group">
                <label>Font</label>
                <select id="subtitleFont">
                    <optgroup label="Traditional Chinese - UI/Web">
                        <option value="'PingFang TC', 'PingFangTC-Regular', sans-serif">PingFang TC (Standard)</option>
                        <option value="'PingFangTC-Medium', 'PingFang TC', sans-serif">PingFang TC Medium</option>
                        <option value="'Heiti TC', 'Heiti TC Light', sans-serif">Heiti TC</option>
                    </optgroup>
                    <optgroup label="Traditional Chinese - Serif/Classic">
                        <option value="'Songti TC', 'Songti TC Regular', serif">Songti TC Regular</option>
                        <option value="'Kaiti TC', serif">Kaiti TC (Calligraphy)</option>
                    </optgroup>
                    <optgroup label="Latin / System">
                        <option value="system-ui, -apple-system, sans-serif" selected>System UI</option>
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="Helvetica, sans-serif">Helvetica</option>
                    </optgroup>
                </select>
            </div>

            <div class="input-group">
                <label>Size (pt)</label>
                <div class="slider-group">
                    <input type="range" id="subtitleSize" min="14" max="800" value="36">
                    <input type="number" id="subtitleSizeNum" value="36" min="14" max="800">
                </div>
            </div>

            <div class="input-group">
                <label>Color</label>
                <input type="color" id="subtitleColor" value="#555555">
            </div>
        </div>

        <div class="control-section">
            <h3>‚ö°Ô∏è Tools</h3>
            <button class="btn btn-secondary" id="btnPresets">üí° Inspirational Caption</button>
            <button class="btn btn-secondary" id="btnRandomStyle">üé® Randomize Style</button>
            <button class="btn btn-secondary" id="btnCenterText">üéØ Auto-Center Text</button>
            <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 15px 0;">
            <button class="btn btn-primary" id="btnExport">üì• Download PNG</button>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    
    // --- State ---
    let state = {
        mainImage: new Image(),
        mainImageLoaded: false,
        bgImage: new Image(),
        bgImageLoaded: false,
        bgColor: '#e5e5ea',
        
        photoScale: 85, // %
        frameColor: '#ffffff',
        frameWidth: 30,

        title: {
            text: 'Memories',
            font: "'PingFang TC', 'PingFangTC-Regular', sans-serif",
            size: 100,
            color: '#000000',
            x: 0,
            y: 0,
            isDragging: false
        },
        subtitle: {
            text: '2025',
            font: "system-ui, -apple-system, sans-serif",
            size: 36,
            color: '#555555',
            x: 0,
            y: 0,
            isDragging: false
        }
    };

    // --- Placeholder / Init ---
    function initPlaceholder() {
        canvas.width = 1200;
        canvas.height = 800;
        
        // Background
        ctx.fillStyle = "#eee";
        ctx.fillRect(0,0,1200,800);
        
        // Placeholder "Photo"
        ctx.fillStyle = "#fff";
        ctx.fillRect(300, 200, 600, 400); // White Frame
        
        ctx.fillStyle = "#ddd";
        ctx.fillRect(320, 220, 560, 360); // Photo area

        ctx.font = "30px sans-serif";
        ctx.fillStyle = "#888";
        ctx.textAlign = "center";
        ctx.fillText("Upload Main Photo to Begin", 600, 400);

        state.title.x = 600;
        state.title.y = 680;
        state.subtitle.x = 600;
        state.subtitle.y = 740;
    }

    initPlaceholder();

    // --- Drawing Logic ---
    function draw() {
        if (!state.mainImageLoaded) return;

        // 1. Canvas Dimensions = Main Image Natural Size
        // This ensures the photo is always high resolution
        canvas.width = state.mainImage.naturalWidth;
        canvas.height = state.mainImage.naturalHeight;
        
        const w = canvas.width;
        const h = canvas.height;

        // 2. Draw Background Layer (Stretched to fit canvas)
        if (state.bgImageLoaded) {
            ctx.drawImage(state.bgImage, 0, 0, w, h);
        } else {
            ctx.fillStyle = state.bgColor;
            ctx.fillRect(0, 0, w, h);
        }

        // 3. Calculate Photo Dimensions based on Scale
        // Scale 100 = Full canvas size
        // Scale 80 = 80% size centered
        const scaleFactor = state.photoScale / 100;
        const photoW = w * scaleFactor;
        const photoH = h * scaleFactor;
        const photoX = (w - photoW) / 2;
        const photoY = (h - photoH) / 2;

        // 4. Draw Solid Frame (Border) BEHIND Photo
        // The frame extends OUTWARD from the photo by frameWidth pixels
        const fWidth = parseInt(state.frameWidth);
        if (fWidth > 0) {
            ctx.fillStyle = state.frameColor;
            
            // Draw a rectangle larger than the photo
            ctx.fillRect(
                photoX - fWidth, 
                photoY - fWidth, 
                photoW + (fWidth * 2), 
                photoH + (fWidth * 2)
            );
            
            // Optional: Subtle shadow behind the frame for depth
            // ctx.shadowColor = "rgba(0,0,0,0.2)";
            // ctx.shadowBlur = 20;
            // ctx.fillRect(...same...)
            // ctx.shadowColor = "transparent";
        }

        // 5. Draw Main Photo
        ctx.drawImage(state.mainImage, photoX, photoY, photoW, photoH);

        // 6. Draw Text
        drawTextObj(state.title);
        drawTextObj(state.subtitle);
    }

    function drawTextObj(obj) {
        ctx.save();
        ctx.font = `${obj.size}px ${obj.font}`;
        ctx.fillStyle = obj.color;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(obj.text, obj.x, obj.y);
        ctx.restore();
    }

    // --- Inputs & DOM ---
    const dom = {
        imgUpload: document.getElementById('imageUpload'),
        photoScale: document.getElementById('photoScale'),
        photoScaleNum: document.getElementById('photoScaleNum'),
        
        frameColor: document.getElementById('frameColor'),
        frameWidth: document.getElementById('frameWidth'),
        frameWidthNum: document.getElementById('frameWidthNum'),

        bgUpload: document.getElementById('bgUpload'),
        bgColor: document.getElementById('bgColor'),
        
        titleText: document.getElementById('titleText'),
        titleFont: document.getElementById('titleFont'),
        titleSize: document.getElementById('titleSize'),
        titleSizeNum: document.getElementById('titleSizeNum'),
        titleColor: document.getElementById('titleColor'),
        
        subText: document.getElementById('subtitleText'),
        subFont: document.getElementById('subtitleFont'),
        subSize: document.getElementById('subtitleSize'),
        subSizeNum: document.getElementById('subtitleSizeNum'),
        subColor: document.getElementById('subtitleColor'),
        
        btnExport: document.getElementById('btnExport'),
        btnCenter: document.getElementById('btnCenterText'),
        btnPresets: document.getElementById('btnPresets'),
        btnRandom: document.getElementById('btnRandomStyle')
    };

    function syncInputs(slider, number, key, subKey) {
        slider.addEventListener('input', (e) => {
            number.value = e.target.value;
            if(subKey) state[key][subKey] = parseInt(e.target.value);
            else state[key] = parseInt(e.target.value);
            draw();
        });
        number.addEventListener('input', (e) => {
            slider.value = e.target.value;
            if(subKey) state[key][subKey] = parseInt(e.target.value);
            else state[key] = parseInt(e.target.value);
            draw();
        });
    }

    // Main Image
    dom.imgUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            state.mainImage = new Image();
            state.mainImage.onload = () => {
                state.mainImageLoaded = true;
                // Defaults
                const h = state.mainImage.naturalHeight;
                state.title.size = Math.floor(h * 0.08);
                dom.titleSize.value = state.title.size;
                dom.titleSizeNum.value = state.title.size;
                
                state.subtitle.size = Math.floor(h * 0.04);
                dom.subtitleSize.value = state.subtitle.size;
                dom.subtitleSizeNum.value = state.subtitle.size;
                
                centerText();
                draw();
            };
            state.mainImage.src = event.target.result;
        };
        reader.readAsDataURL(file);
    });

    // Scale Logic
    syncInputs(dom.photoScale, dom.photoScaleNum, 'photoScale');

    // Frame Logic
    dom.frameColor.addEventListener('input', (e) => { state.frameColor = e.target.value; draw(); });
    syncInputs(dom.frameWidth, dom.frameWidthNum, 'frameWidth');

    // Background Logic
    dom.bgUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            state.bgImage = new Image();
            state.bgImage.onload = () => {
                state.bgImageLoaded = true;
                draw();
            };
            state.bgImage.src = event.target.result;
        };
        reader.readAsDataURL(file);
    });
    dom.bgColor.addEventListener('input', (e) => { state.bgColor = e.target.value; draw(); });

    // Text Logic
    dom.titleText.addEventListener('input', (e) => { state.title.text = e.target.value; draw(); });
    dom.titleFont.addEventListener('change', (e) => { state.title.font = e.target.value; draw(); });
    dom.titleColor.addEventListener('input', (e) => { state.title.color = e.target.value; draw(); });
    syncInputs(dom.titleSize, dom.titleSizeNum, 'title', 'size');

    dom.subText.addEventListener('input', (e) => { state.subtitle.text = e.target.value; draw(); });
    dom.subFont.addEventListener('change', (e) => { state.subtitle.font = e.target.value; draw(); });
    dom.subColor.addEventListener('input', (e) => { state.subtitle.color = e.target.value; draw(); });
    syncInputs(dom.subSize, dom.subSizeNum, 'subtitle', 'size');

    // --- Dragging ---
    function getCanvasCoords(e) {
        const rect = canvas.getBoundingClientRect();
        let clientX, clientY;
        if (e.touches && e.touches.length > 0) {
            clientX = e.touches[0].clientX;
            clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        return {
            x: (clientX - rect.left) * scaleX,
            y: (clientY - rect.top) * scaleY
        };
    }

    function isHit(obj, x, y) {
        ctx.font = `${obj.size}px ${obj.font}`;
        const metrics = ctx.measureText(obj.text);
        const width = metrics.width;
        const height = obj.size; 
        const left = obj.x - width / 2;
        const right = obj.x + width / 2;
        const top = obj.y - height / 2;
        const bottom = obj.y + height / 2;
        return (x >= left && x <= right && y >= top && y <= bottom);
    }

    let dragTarget = null;
    let dragStart = { x: 0, y: 0 };
    let objStart = { x: 0, y: 0 };

    function handleStart(e) {
        if (!state.mainImageLoaded) return;
        const coords = getCanvasCoords(e);
        if (isHit(state.subtitle, coords.x, coords.y)) {
            dragTarget = state.subtitle;
        } else if (isHit(state.title, coords.x, coords.y)) {
            dragTarget = state.title;
        }
        if (dragTarget) {
            dragTarget.isDragging = true;
            dragStart = coords;
            objStart = { x: dragTarget.x, y: dragTarget.y };
        }
    }

    function handleMove(e) {
        if (!dragTarget || !state.mainImageLoaded) return;
        e.preventDefault();
        const coords = getCanvasCoords(e);
        const dx = coords.x - dragStart.x;
        const dy = coords.y - dragStart.y;
        dragTarget.x = objStart.x + dx;
        dragTarget.y = objStart.y + dy;
        draw();
    }

    function handleEnd() {
        if (dragTarget) {
            dragTarget.isDragging = false;
            dragTarget = null;
        }
    }

    canvas.addEventListener('mousedown', handleStart);
    canvas.addEventListener('mousemove', handleMove);
    canvas.addEventListener('mouseup', handleEnd);
    canvas.addEventListener('mouseleave', handleEnd);
    canvas.addEventListener('touchstart', handleStart, { passive: false });
    canvas.addEventListener('touchmove', handleMove, { passive: false });
    canvas.addEventListener('touchend', handleEnd);

    // --- Tools ---
    function centerText() {
        if (!state.mainImageLoaded) return;
        const w = canvas.width;
        const h = canvas.height;
        state.title.x = w / 2;
        state.title.y = h * 0.90;
        state.subtitle.x = w / 2;
        state.subtitle.y = h * 0.96;
        draw();
    }
    dom.btnCenter.addEventListener('click', centerText);

    const captions = [
        "Chasing Moments",
        "Visual Diary",
        "A Beautiful Life",
        "Quiet Reflections",
        "Unforgettable",
        "Timeless",
        "Just Be."
    ];
    dom.btnPresets.addEventListener('click', () => {
        const r = Math.floor(Math.random() * captions.length);
        state.title.text = captions[r];
        dom.titleText.value = captions[r];
        draw();
    });

    const colors = ['#000000', '#FFFFFF', '#FF3B30', '#007AFF', '#FFCC00'];
    dom.btnRandom.addEventListener('click', () => {
        const c1 = colors[Math.floor(Math.random() * colors.length)];
        state.title.color = c1;
        dom.titleColor.value = c1;
        const c2 = colors[Math.floor(Math.random() * colors.length)];
        state.subtitle.color = c2;
        dom.subColor.value = c2;
        draw();
    });

    dom.btnExport.addEventListener('click', () => {
        if (!state.mainImageLoaded) {
            alert("Please upload a Main Photo first.");
            return;
        }
        const link = document.createElement('a');
        link.download = `frame-art-${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
    });

</script>
</body>
</html>
