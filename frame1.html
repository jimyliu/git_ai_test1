<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Image Frame Tool ‚Äî 2025-12-30 15:09:51</title>
    <style>
        :root {
            --bg-color: #f4f4f7;
            --panel-bg: #ffffff;
            --text-color: #333333;
            --accent-color: #007aff;
            --border-color: #e0e0e0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            font-family: var(--font-ui);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        header {
            background: var(--panel-bg);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
            z-index: 10;
        }

        h1 {
            font-size: 18px;
            margin: 0;
            font-weight: 600;
            color: var(--text-color);
        }

        .version-tag {
            font-size: 12px;
            color: #888;
            font-family: monospace;
        }

        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Canvas Area */
        .canvas-area {
            flex: 1;
            background-color: #e5e5e5;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: auto;
            background-image: radial-gradient(#ccc 1px, transparent 1px);
            background-size: 20px 20px;
        }

        canvas {
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 100%;
            max-height: 100%;
            cursor: crosshair;
            touch-action: none; /* Critical for touch dragging */
        }

        /* Controls Sidebar */
        .controls {
            width: 340px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            padding-bottom: 40px;
        }

        .control-section {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .control-section h3 {
            margin: 0 0 15px 0;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #666;
        }

        /* Form Elements */
        .input-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
            font-family: var(--font-ui);
        }

        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 100%;
            height: 36px;
            border-radius: 6px;
            cursor: pointer;
            padding: 0;
            overflow: hidden;
        }

        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
        }

        .slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="range"] {
            flex: 1;
            accent-color: var(--accent-color);
        }

        input[type="number"] {
            width: 60px;
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 8px;
            text-align: center;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        .btn-primary:hover {
            background-color: #0066d6;
        }

        .btn-secondary {
            background-color: #f0f0f5;
            color: #333;
        }
        .btn-secondary:hover {
            background-color: #e0e0e5;
        }

        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-upload-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                height: auto;
                overflow-y: auto;
            }
            .main-container {
                flex-direction: column;
            }
            .canvas-area {
                height: 50vh;
                min-height: 300px;
                order: 1;
            }
            .controls {
                width: 100%;
                height: auto;
                order: 2;
                border-left: none;
                border-top: 1px solid var(--border-color);
            }
        }

        /* Font Specifics */
        optgroup { font-style: normal; font-weight: bold; color: #666; }
        option { color: #000; }
    </style>
</head>
<body>

<header>
    <div>
        <h1>AI Image Frame Tool</h1>
        <span class="version-tag">2025-12-30 15:09:51</span>
    </div>
</header>

<div class="main-container">
    <div class="canvas-area">
        <canvas id="mainCanvas"></canvas>
    </div>

    <div class="controls">
        <div class="control-section">
            <h3>üñº Source & Frame</h3>
            <div class="input-group">
                <div class="file-upload-wrapper">
                    <button class="btn btn-secondary">üìÇ Upload Image</button>
                    <input type="file" id="imageUpload" accept="image/*">
                </div>
            </div>
            
            <div class="input-group">
                <label>Frame Color</label>
                <input type="color" id="frameColor" value="#ffffff">
            </div>

            <div class="input-group">
                <label>Frame Thickness</label>
                <div class="slider-group">
                    <input type="range" id="frameWidth" min="0" max="200" value="40">
                    <input type="number" id="frameWidthNum" value="40" min="0" max="200">
                </div>
            </div>
        </div>

        <div class="control-section">
            <h3>üìù Title Layer</h3>
            <div class="input-group">
                <input type="text" id="titleText" value="Traditional Style">
            </div>
            
            <div class="input-group">
                <label>Font</label>
                <select id="titleFont">
                    <optgroup label="Traditional Chinese - UI/Web">
                        <option value="'PingFang TC', 'PingFangTC-Regular', sans-serif">PingFang TC (Standard)</option>
                        <option value="'PingFangTC-Medium', 'PingFang TC', sans-serif">PingFang TC Medium</option>
                        <option value="'PingFangTC-Semibold', 'PingFang TC', sans-serif">PingFang TC Semibold</option>
                        <option value="'Heiti TC', 'Heiti TC Light', sans-serif">Heiti TC</option>
                        <option value="'Heiti TC Medium', 'Heiti TC', sans-serif">Heiti TC Medium</option>
                    </optgroup>
                    <optgroup label="Traditional Chinese - Serif/Classic">
                        <option value="'Songti TC', 'Songti TC Regular', serif">Songti TC Regular</option>
                        <option value="'Songti TC Bold', 'Songti TC', serif">Songti TC Bold</option>
                        <option value="'Kaiti TC', serif">Kaiti TC (Calligraphy)</option>
                    </optgroup>
                    <optgroup label="Latin / System">
                        <option value="system-ui, -apple-system, sans-serif">System UI</option>
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="Helvetica, sans-serif">Helvetica</option>
                    </optgroup>
                </select>
            </div>

            <div class="input-group">
                <label>Size (pt)</label>
                <div class="slider-group">
                    <input type="range" id="titleSize" min="14" max="800" value="80">
                    <input type="number" id="titleSizeNum" value="80" min="14" max="800">
                </div>
            </div>

            <div class="input-group">
                <label>Color</label>
                <input type="color" id="titleColor" value="#000000">
            </div>
        </div>

        <div class="control-section">
            <h3>‚úçÔ∏è Subtitle Layer</h3>
            <div class="input-group">
                <input type="text" id="subtitleText" value="Captured in Taipei, 2025">
            </div>

            <div class="input-group">
                <label>Font</label>
                <select id="subtitleFont">
                    <optgroup label="Traditional Chinese - UI/Web">
                        <option value="'PingFang TC', 'PingFangTC-Regular', sans-serif">PingFang TC (Standard)</option>
                        <option value="'PingFangTC-Medium', 'PingFang TC', sans-serif">PingFang TC Medium</option>
                        <option value="'Heiti TC', 'Heiti TC Light', sans-serif">Heiti TC</option>
                    </optgroup>
                    <optgroup label="Traditional Chinese - Serif/Classic">
                        <option value="'Songti TC', 'Songti TC Regular', serif">Songti TC Regular</option>
                        <option value="'Kaiti TC', serif">Kaiti TC (Calligraphy)</option>
                    </optgroup>
                    <optgroup label="Latin / System">
                        <option value="system-ui, -apple-system, sans-serif" selected>System UI</option>
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="Helvetica, sans-serif">Helvetica</option>
                    </optgroup>
                </select>
            </div>

            <div class="input-group">
                <label>Size (pt)</label>
                <div class="slider-group">
                    <input type="range" id="subtitleSize" min="14" max="800" value="32">
                    <input type="number" id="subtitleSizeNum" value="32" min="14" max="800">
                </div>
            </div>

            <div class="input-group">
                <label>Color</label>
                <input type="color" id="subtitleColor" value="#666666">
            </div>
        </div>

        <div class="control-section">
            <h3>‚ö°Ô∏è Smart Tools</h3>
            <button class="btn btn-secondary" id="btnPresets">üí° Inspirational Caption</button>
            <button class="btn btn-secondary" id="btnRandomStyle">üé® Randomize Style</button>
            <button class="btn btn-secondary" id="btnCenterText">üéØ Auto-Center Text</button>
            <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 15px 0;">
            <button class="btn btn-primary" id="btnExport">üì• Download PNG</button>
        </div>
    </div>
</div>

<script>
    // --- State Management ---
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    
    // Default State
    let state = {
        image: new Image(),
        imageLoaded: false,
        frameColor: '#ffffff',
        frameWidth: 40,
        title: {
            text: 'Visual Harmony',
            font: "'PingFang TC', 'PingFangTC-Regular', sans-serif",
            size: 80,
            color: '#000000',
            x: 0,
            y: 0,
            isDragging: false
        },
        subtitle: {
            text: 'Captured on a bright afternoon',
            font: "system-ui, -apple-system, sans-serif",
            size: 32,
            color: '#666666',
            x: 0,
            y: 0,
            isDragging: false
        }
    };

    // Placeholder Logic
    function initPlaceholder() {
        canvas.width = 1200;
        canvas.height = 800;
        
        // Draw a placeholder gradient/rect until image loads
        ctx.fillStyle = "#ddd";
        ctx.fillRect(0,0,1200,800);
        ctx.font = "40px sans-serif";
        ctx.fillStyle = "#888";
        ctx.textAlign = "center";
        ctx.fillText("Upload an image to start", 600, 400);

        // Set initial text positions based on this size
        state.title.x = 600;
        state.title.y = 650;
        state.subtitle.x = 600;
        state.subtitle.y = 700;
    }

    initPlaceholder();

    // --- Core Rendering Loop ---
    function draw() {
        if (!state.imageLoaded) return;

        // 1. Clear & Draw Image
        canvas.width = state.image.naturalWidth;
        canvas.height = state.image.naturalHeight;
        
        ctx.drawImage(state.image, 0, 0);

        // 2. Draw Frame (Border Inset)
        // To keep border uniform, we draw 4 rectangles along the edges
        const fw = parseInt(state.frameWidth);
        const w = canvas.width;
        const h = canvas.height;

        ctx.fillStyle = state.frameColor;
        
        // Top
        ctx.fillRect(0, 0, w, fw);
        // Bottom
        ctx.fillRect(0, h - fw, w, fw);
        // Left
        ctx.fillRect(0, fw, fw, h - (fw * 2));
        // Right
        ctx.fillRect(w - fw, fw, fw, h - (fw * 2));

        // 3. Draw Text
        drawTextObj(state.title);
        drawTextObj(state.subtitle);
    }

    function drawTextObj(obj) {
        ctx.save();
        ctx.font = `${obj.size}px ${obj.font}`;
        ctx.fillStyle = obj.color;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        
        // Shadow for better visibility if needed (subtle)
        // ctx.shadowColor = "rgba(0,0,0,0.1)";
        // ctx.shadowBlur = 4;

        ctx.fillText(obj.text, obj.x, obj.y);
        
        // Debug box logic for drag detection (invisible)
        /* const metrics = ctx.measureText(obj.text);
        const h = obj.size; 
        ctx.strokeStyle = "red";
        ctx.strokeRect(obj.x - metrics.width/2, obj.y - h/2, metrics.width, h);
        */
        
        ctx.restore();
    }

    // --- Inputs & Event Listeners ---

    // DOM Elements
    const dom = {
        imgUpload: document.getElementById('imageUpload'),
        frameColor: document.getElementById('frameColor'),
        frameWidth: document.getElementById('frameWidth'),
        frameWidthNum: document.getElementById('frameWidthNum'),
        
        titleText: document.getElementById('titleText'),
        titleFont: document.getElementById('titleFont'),
        titleSize: document.getElementById('titleSize'),
        titleSizeNum: document.getElementById('titleSizeNum'),
        titleColor: document.getElementById('titleColor'),
        
        subText: document.getElementById('subtitleText'),
        subFont: document.getElementById('subtitleFont'),
        subSize: document.getElementById('subtitleSize'),
        subSizeNum: document.getElementById('subtitleSizeNum'),
        subColor: document.getElementById('subtitleColor'),
        
        btnExport: document.getElementById('btnExport'),
        btnCenter: document.getElementById('btnCenterText'),
        btnPresets: document.getElementById('btnPresets'),
        btnRandom: document.getElementById('btnRandomStyle')
    };

    // Helper to sync slider and number
    function syncInputs(slider, number, key, subKey) {
        slider.addEventListener('input', (e) => {
            number.value = e.target.value;
            if(subKey) state[key][subKey] = parseInt(e.target.value);
            else state[key] = parseInt(e.target.value);
            draw();
        });
        number.addEventListener('input', (e) => {
            slider.value = e.target.value;
            if(subKey) state[key][subKey] = parseInt(e.target.value);
            else state[key] = parseInt(e.target.value);
            draw();
        });
    }

    // Image Upload
    dom.imgUpload.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            state.image = new Image();
            state.image.onload = () => {
                state.imageLoaded = true;
                
                // Smart default sizing
                const h = state.image.naturalHeight;
                // Frame proportional
                state.frameWidth = Math.max(20, Math.floor(h * 0.05));
                dom.frameWidth.value = state.frameWidth;
                dom.frameWidthNum.value = state.frameWidth;

                // Font proportional
                state.title.size = Math.floor(h * 0.08);
                dom.titleSize.value = state.title.size;
                dom.titleSizeNum.value = state.title.size;

                state.subtitle.size = Math.floor(h * 0.035);
                dom.subtitleSize.value = state.subtitle.size;
                dom.subtitleSizeNum.value = state.subtitle.size;

                centerText();
                draw();
            };
            state.image.src = event.target.result;
        };
        reader.readAsDataURL(file);
    });

    // Frame
    dom.frameColor.addEventListener('input', (e) => { state.frameColor = e.target.value; draw(); });
    syncInputs(dom.frameWidth, dom.frameWidthNum, 'frameWidth');

    // Title
    dom.titleText.addEventListener('input', (e) => { state.title.text = e.target.value; draw(); });
    dom.titleFont.addEventListener('change', (e) => { state.title.font = e.target.value; draw(); });
    dom.titleColor.addEventListener('input', (e) => { state.title.color = e.target.value; draw(); });
    syncInputs(dom.titleSize, dom.titleSizeNum, 'title', 'size');

    // Subtitle
    dom.subText.addEventListener('input', (e) => { state.subtitle.text = e.target.value; draw(); });
    dom.subFont.addEventListener('change', (e) => { state.subtitle.font = e.target.value; draw(); });
    dom.subColor.addEventListener('input', (e) => { state.subtitle.color = e.target.value; draw(); });
    syncInputs(dom.subSize, dom.subSizeNum, 'subtitle', 'size');

    // --- Positioning Logic (Drag & Drop) ---
    let dragTarget = null;
    let dragStart = { x: 0, y: 0 };
    let objStart = { x: 0, y: 0 };

    function getCanvasCoords(e) {
        const rect = canvas.getBoundingClientRect();
        let clientX, clientY;
        
        if (e.touches && e.touches.length > 0) {
            clientX = e.touches[0].clientX;
            clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }

        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;

        return {
            x: (clientX - rect.left) * scaleX,
            y: (clientY - rect.top) * scaleY
        };
    }

    function isHit(obj, x, y) {
        ctx.font = `${obj.size}px ${obj.font}`;
        const metrics = ctx.measureText(obj.text);
        const width = metrics.width;
        const height = obj.size; // approximation usually works well for hit targets
        
        // Centered text logic
        const left = obj.x - width / 2;
        const right = obj.x + width / 2;
        const top = obj.y - height / 2;
        const bottom = obj.y + height / 2;

        return (x >= left && x <= right && y >= top && y <= bottom);
    }

    function handleStart(e) {
        if (!state.imageLoaded) return;
        const coords = getCanvasCoords(e);
        
        // Check Subtitle first (usually smaller/on top)
        if (isHit(state.subtitle, coords.x, coords.y)) {
            dragTarget = state.subtitle;
        } else if (isHit(state.title, coords.x, coords.y)) {
            dragTarget = state.title;
        }

        if (dragTarget) {
            dragTarget.isDragging = true;
            dragStart = coords;
            objStart = { x: dragTarget.x, y: dragTarget.y };
        }
    }

    function handleMove(e) {
        if (!dragTarget || !state.imageLoaded) return;
        e.preventDefault(); // Stop scrolling on mobile
        
        const coords = getCanvasCoords(e);
        const dx = coords.x - dragStart.x;
        const dy = coords.y - dragStart.y;

        dragTarget.x = objStart.x + dx;
        dragTarget.y = objStart.y + dy;
        
        draw();
    }

    function handleEnd() {
        if (dragTarget) {
            dragTarget.isDragging = false;
            dragTarget = null;
        }
    }

    // Mouse Events
    canvas.addEventListener('mousedown', handleStart);
    canvas.addEventListener('mousemove', handleMove);
    canvas.addEventListener('mouseup', handleEnd);
    canvas.addEventListener('mouseleave', handleEnd);

    // Touch Events (Passive false for preventDefault)
    canvas.addEventListener('touchstart', handleStart, { passive: false });
    canvas.addEventListener('touchmove', handleMove, { passive: false });
    canvas.addEventListener('touchend', handleEnd);

    // --- AI / Smart Features ---

    function centerText() {
        if (!state.imageLoaded) return;
        const w = canvas.width;
        const h = canvas.height;
        
        state.title.x = w / 2;
        state.title.y = h * 0.85;
        
        state.subtitle.x = w / 2;
        state.subtitle.y = h * 0.92;
        
        draw();
    }
    
    dom.btnCenter.addEventListener('click', centerText);

    const captions = [
        "Quiet moments speak volumes.",
        "Simplicity is the ultimate sophistication.",
        "Chasing the light.",
        "Memory preserved.",
        "In the mood for love.",
        "Echoes of silence.",
        "Urban solitude.",
        "Nature's whisper."
    ];

    dom.btnPresets.addEventListener('click', () => {
        const r = Math.floor(Math.random() * captions.length);
        state.subtitle.text = captions[r];
        dom.subText.value = captions[r];
        draw();
    });

    const colors = ['#000000', '#FFFFFF', '#FF3B30', '#007AFF', '#FFCC00', '#5856D6', '#8E8E93'];
    
    dom.btnRandom.addEventListener('click', () => {
        // Randomize Title Color
        const c1 = colors[Math.floor(Math.random() * colors.length)];
        state.title.color = c1;
        dom.titleColor.value = c1;

        // Randomize Subtitle Color
        const c2 = colors[Math.floor(Math.random() * colors.length)];
        state.subtitle.color = c2;
        dom.subColor.value = c2;

        // Randomize Font (pick random option index)
        const opts = dom.titleFont.options;
        const rFontIndex = Math.floor(Math.random() * opts.length);
        const rFontVal = opts[rFontIndex].value;
        
        state.title.font = rFontVal;
        dom.titleFont.value = rFontVal;
        
        state.subtitle.font = rFontVal;
        dom.subFont.value = rFontVal;

        draw();
    });

    // --- Export ---
    dom.btnExport.addEventListener('click', () => {
        if (!state.imageLoaded) {
            alert("Please upload an image first.");
            return;
        }
        const link = document.createElement('a');
        link.download = `framed-${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
    });

</script>
</body>
</html>
