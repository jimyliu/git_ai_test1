<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AI Image Frame Tool</title>
<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
      "PingFang TC","PingFang SC","Heiti TC","Microsoft JhengHei",
      "Noto Sans CJK TC","Source Han Sans","Helvetica","Arial",sans-serif;
    background: #f5f6f8;
    color: #222;
  }
  .app {
    max-width: 1200px;
    margin: 0 auto;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    background: #fff;
    padding: 12px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  .group {
    display: flex;
    flex-direction: column;
    gap: 6px;
    min-width: 140px;
  }
  .group label {
    font-size: 12px;
    color: #555;
  }
  input[type="text"],
  input[type="number"],
  select {
    padding: 6px 8px;
    font-size: 14px;
  }
  input[type="range"] {
    width: 140px;
  }
  .canvas-wrap {
    background: #fff;
    padding: 12px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  canvas {
    max-width: 100%;
    height: auto;
    touch-action: none;
  }
  .actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
  }
  button {
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #2563eb;
    color: #fff;
  }
  button.secondary {
    background: #6b7280;
  }
  @media (max-width: 768px) {
    .toolbar {
      flex-direction: column;
    }
    .actions {
      justify-content: center;
    }
  }
</style>
</head>
<body>
<div class="app">
  <div class="toolbar">
    <div class="group">
      <label>Upload Image</label>
      <input type="file" id="imageInput" accept="image/*">
    </div>

    <div class="group">
      <label>Frame Color</label>
      <input type="color" id="frameColor" value="#000000">
    </div>

    <div class="group">
      <label>Frame Thickness</label>
      <input type="range" id="frameThickness" min="0" max="100" value="20">
    </div>

    <div class="group">
      <label>Title Text</label>
      <input type="text" id="titleText" value="Title">
    </div>

    <div class="group">
      <label>Title Font</label>
      <select id="titleFont"></select>
    </div>

    <div class="group">
      <label>Title Color</label>
      <input type="color" id="titleColor" value="#ffffff">
    </div>

    <div class="group">
      <label>Title Size</label>
      <input type="range" id="titleSizeRange" min="14" max="200" value="48">
      <input type="number" id="titleSizeNumber" min="14" max="200" value="48">
    </div>

    <div class="group">
      <label>Subtitle Text</label>
      <input type="text" id="subtitleText" value="Subtitle">
    </div>

    <div class="group">
      <label>Subtitle Font</label>
      <select id="subtitleFont"></select>
    </div>

    <div class="group">
      <label>Subtitle Color</label>
      <input type="color" id="subtitleColor" value="#ffffff">
    </div>

    <div class="group">
      <label>Subtitle Size</label>
      <input type="range" id="subtitleSizeRange" min="14" max="200" value="28">
      <input type="number" id="subtitleSizeNumber" min="14" max="200" value="28">
    </div>
  </div>

  <div class="canvas-wrap">
    <canvas id="canvas"></canvas>
  </div>

  <div class="actions">
    <button id="randomStyle" class="secondary">Random Style</button>
    <button id="download">Download PNG</button>
  </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

let image = null;

const fonts = [
  "system-ui",
  "Arial",
  "Helvetica",
  "PingFang TC",
  "PingFang SC",
  "Heiti TC",
  "Microsoft JhengHei",
  "Noto Sans CJK TC",
  "Source Han Sans"
];

const title = {
  text: "Title",
  x: 0,
  y: 0,
  size: 48,
  color: "#ffffff",
  font: fonts[0]
};

const subtitle = {
  text: "Subtitle",
  x: 0,
  y: 0,
  size: 28,
  color: "#ffffff",
  font: fonts[0]
};

let dragging = null;
let offsetX = 0;
let offsetY = 0;

function populateFonts(select) {
  fonts.forEach(f => {
    const opt = document.createElement("option");
    opt.value = f;
    opt.textContent = f;
    select.appendChild(opt);
  });
}

populateFonts(document.getElementById("titleFont"));
populateFonts(document.getElementById("subtitleFont"));

function draw() {
  if (!image) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(image,0,0,canvas.width,canvas.height);

  const thickness = parseInt(frameThickness.value,10);
  if (thickness > 0) {
    ctx.strokeStyle = frameColor.value;
    ctx.lineWidth = thickness;
    ctx.strokeRect(
      thickness/2,
      thickness/2,
      canvas.width - thickness,
      canvas.height - thickness
    );
  }

  drawText(title);
  drawText(subtitle);
}

function drawText(obj) {
  ctx.font = `${obj.size}px ${obj.font}`;
  ctx.fillStyle = obj.color;
  ctx.textAlign = "center";
  ctx.textBaseline = "middle";
  ctx.fillText(obj.text, obj.x, obj.y);
}

function resizeCanvas(w,h) {
  canvas.width = w;
  canvas.height = h;
  title.x = w/2;
  title.y = h*0.3;
  subtitle.x = w/2;
  subtitle.y = h*0.4;
}

imageInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const img = new Image();
  img.onload = () => {
    image = img;
    resizeCanvas(img.width, img.height);
    draw();
  };
  img.src = URL.createObjectURL(file);
};

function bindTextControls(obj, textInput, colorInput, sizeRange, sizeNumber, fontSelect) {
  textInput.oninput = () => { obj.text = textInput.value; draw(); };
  colorInput.oninput = () => { obj.color = colorInput.value; draw(); };
  fontSelect.onchange = () => { obj.font = fontSelect.value; draw(); };
  sizeRange.oninput = () => {
    obj.size = parseInt(sizeRange.value,10);
    sizeNumber.value = obj.size;
    draw();
  };
  sizeNumber.oninput = () => {
    obj.size = parseInt(sizeNumber.value,10);
    sizeRange.value = obj.size;
    draw();
  };
}

bindTextControls(
  title,
  titleText,
  titleColor,
  titleSizeRange,
  titleSizeNumber,
  titleFont
);

bindTextControls(
  subtitle,
  subtitleText,
  subtitleColor,
  subtitleSizeRange,
  subtitleSizeNumber,
  subtitleFont
);

frameColor.oninput = draw;
frameThickness.oninput = draw;

function hitTest(obj, x, y) {
  ctx.font = `${obj.size}px ${obj.font}`;
  const width = ctx.measureText(obj.text).width;
  const height = obj.size;
  return (
    x >= obj.x - width/2 &&
    x <= obj.x + width/2 &&
    y >= obj.y - height/2 &&
    y <= obj.y + height/2
  );
}

function pointerDown(x,y) {
  if (hitTest(title,x,y)) dragging = title;
  else if (hitTest(subtitle,x,y)) dragging = subtitle;
  if (dragging) {
    offsetX = x - dragging.x;
    offsetY = y - dragging.y;
  }
}

function pointerMove(x,y) {
  if (!dragging) return;
  dragging.x = x - offsetX;
  dragging.y = y - offsetY;
  draw();
}

function pointerUp() {
  dragging = null;
}

canvas.addEventListener("mousedown", e => {
  const r = canvas.getBoundingClientRect();
  pointerDown(e.clientX - r.left, e.clientY - r.top);
});
canvas.addEventListener("mousemove", e => {
  const r = canvas.getBoundingClientRect();
  pointerMove(e.clientX - r.left, e.clientY - r.top);
});
window.addEventListener("mouseup", pointerUp);

canvas.addEventListener("touchstart", e => {
  const t = e.touches[0];
  const r = canvas.getBoundingClientRect();
  pointerDown(t.clientX - r.left, t.clientY - r.top);
});
canvas.addEventListener("touchmove", e => {
  const t = e.touches[0];
  const r = canvas.getBoundingClientRect();
  pointerMove(t.clientX - r.left, t.clientY - r.top);
  e.preventDefault();
},{passive:false});
window.addEventListener("touchend", pointerUp);

randomStyle.onclick = () => {
  title.size = Math.floor(40 + Math.random()*80);
  subtitle.size = Math.floor(20 + Math.random()*60);
  title.color = "#"+Math.floor(Math.random()*16777215).toString(16).padStart(6,"0");
  subtitle.color = "#"+Math.floor(Math.random()*16777215).toString(16).padStart(6,"0");
  title.font = fonts[Math.floor(Math.random()*fonts.length)];
  subtitle.font = fonts[Math.floor(Math.random()*fonts.length)];
  titleSizeRange.value = title.size;
  titleSizeNumber.value = title.size;
  subtitleSizeRange.value = subtitle.size;
  subtitleSizeNumber.value = subtitle.size;
  titleFont.value = title.font;
  subtitleFont.value = subtitle.font;
  draw();
};

download.onclick = () => {
  const link = document.createElement("a");
  link.download = "frame.png";
  link.href = canvas.toDataURL("image/png");
  link.click();
};
</script>
</body>
</html>
