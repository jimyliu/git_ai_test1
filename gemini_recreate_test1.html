<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimalist Image Framer</title>
    <style>
        :root {
            --bg-color: #f5f5f7;
            --sidebar-width: 320px;
            --accent: #007aff;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: var(--bg-color);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar Styling */
        #sidebar {
            width: var(--sidebar-width);
            background: white;
            border-right: 1px solid #d2d2d7;
            padding: 24px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
        }

        h2 { font-size: 20px; margin-bottom: 10px; font-weight: 600; }
        .control-group { display: flex; flex-direction: column; gap: 8px; }
        label { font-size: 12px; font-weight: 600; color: #86868b; text-transform: uppercase; }
        
        input[type="text"], select, input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            outline: none;
        }

        .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s;
        }
        .btn:hover { opacity: 0.8; }
        .btn-secondary { background: #e8e8ed; color: #1d1d1f; }

        /* Canvas Area */
        #canvas-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            position: relative;
        }

        canvas {
            background: white;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 100%;
            max-height: 100%;
            cursor: crosshair;
        }
    </style>
</head>
<body>

<div id="sidebar">
    <h2>Editor Controls</h2>
    
    <div class="control-group">
        <label>1. Background Layer</label>
        <input type="file" id="bgInput" accept="image/*">
        <input type="color" id="bgColor" value="#ffffff">
        <span>Opacity</span>
        <input type="range" id="bgOpacity" min="20" max="100" value="100">
    </div>

    <div class="control-group">
        <label>2. Main Photo Layer</label>
        <input type="file" id="photoInput" accept="image/*">
        <span>Photo Scaling</span>
        <input type="range" id="photoScale" min="10" max="150" value="80">
    </div>

    <div class="control-group">
        <label>3. Frame Board</label>
        <span>Thickness</span>
        <input type="range" id="frameThickness" min="0" max="50" value="15">
        <span>Color</span>
        <input type="color" id="frameColor" value="#ffffff">
    </div>

    <div class="control-group">
        <label>4. Typography (Traditional Chinese)</label>
        <input type="text" id="titleText" placeholder="Enter Title...">
        <input type="text" id="subtitleText" placeholder="Enter Subtitle...">
        <select id="fontFamily">
            <option value="'PingFang TC', sans-serif">PingFang TC (Modern)</option>
            <option value="'STSong', 'Songti TC', serif">Songti (Classic)</option>
            <option value="'Kaiti TC', cursive">Kaiti (Calligraphy)</option>
        </select>
    </div>

    <button class="btn" id="downloadBtn">Download PNG</button>
    <button class="btn btn-secondary" id="resetBtn">Reset Positions</button>
</div>

<div id="canvas-container">
    <canvas id="mainCanvas" width="1200" height="1200"></canvas>
</div>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');

    // State Management
    let state = {
        bgImg: null,
        photoImg: null,
        dragging: null,
        layers: {
            bg: { color: '#ffffff', opacity: 1.0 },
            photo: { x: 600, y: 600, scale: 0.8, thickness: 15, color: '#ffffff', w: 0, h: 0 },
            title: { x: 600, y: 1050, text: '', size: 60 },
            subtitle: { x: 600, y: 1120, text: '', size: 35 }
        }
    };

    // Initialization
    function init() {
        draw();
        setupEventListeners();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. Draw Background Color
        ctx.fillStyle = state.layers.bg.color;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // 2. Draw Background Image
        if (state.bgImg) {
            ctx.globalAlpha = state.layers.bg.opacity;
            ctx.drawImage(state.bgImg, 0, 0, canvas.width, canvas.height);
            ctx.globalAlpha = 1.0;
        }

        // 3. Draw Photo + Frame
        if (state.photoImg) {
            const p = state.layers.photo;
            const drawW = p.w * p.scale;
            const drawH = p.h * p.scale;
            
            // Draw Frame Board
            ctx.fillStyle = p.color;
            ctx.fillRect(
                p.x - (drawW / 2) - p.thickness, 
                p.y - (drawH / 2) - p.thickness, 
                drawW + (p.thickness * 2), 
                drawH + (p.thickness * 2)
            );

            // Draw Photo
            ctx.drawImage(state.photoImg, p.x - (drawW / 2), p.y - (drawH / 2), drawW, drawH);
        }

        // 4. Draw Text
        ctx.textAlign = 'center';
        ctx.fillStyle = '#1d1d1f';
        const font = document.getElementById('fontFamily').value;

        ctx.font = `bold ${state.layers.title.size}px ${font}`;
        ctx.fillText(state.layers.title.text, state.layers.title.x, state.layers.title.y);

        ctx.font = `${state.layers.subtitle.size}px ${font}`;
        ctx.fillText(state.layers.subtitle.text, state.layers.subtitle.x, state.layers.subtitle.y);

        requestAnimationFrame(draw);
    }

    function setupEventListeners() {
        // Image Uploads
        document.getElementById('bgInput').onchange = e => {
            const reader = new FileReader();
            reader.onload = event => {
                const img = new Image();
                img.onload = () => { state.bgImg = img; };
                img.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        document.getElementById('photoInput').onchange = e => {
            const reader = new FileReader();
            reader.onload = event => {
                const img = new Image();
                img.onload = () => { 
                    state.photoImg = img; 
                    state.layers.photo.w = img.width;
                    state.layers.photo.h = img.height;
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(e.target.files[0]);
        };

        // Inputs
        document.getElementById('bgOpacity').oninput = e => state.layers.bg.opacity = e.target.value / 100;
        document.getElementById('bgColor').oninput = e => state.layers.bg.color = e.target.value;
        document.getElementById('photoScale').oninput = e => state.layers.photo.scale = e.target.value / 100;
        document.getElementById('frameThickness').oninput = e => state.layers.photo.thickness = parseInt(e.target.value);
        document.getElementById('frameColor').oninput = e => state.layers.photo.color = e.target.value;
        document.getElementById('titleText').oninput = e => state.layers.title.text = e.target.value;
        document.getElementById('subtitleText').oninput = e => state.layers.subtitle.text = e.target.value;

        // Reset & Download
        document.getElementById('resetBtn').onclick = () => {
            state.layers.photo.x = 600; state.layers.photo.y = 600;
            state.layers.title.x = 600; state.layers.title.y = 1050;
            state.layers.subtitle.x = 600; state.layers.subtitle.y = 1120;
        };

        document.getElementById('downloadBtn').onclick = () => {
            const link = document.createElement('a');
            link.download = 'framed-photo.png';
            link.href = canvas.toDataURL();
            link.click();
        };

        // Dragging Logic
        canvas.onmousedown = e => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
            const mouseY = (e.clientY - rect.top) * (canvas.height / rect.height);

            // Check layers from top to bottom
            if (Math.abs(mouseY - state.layers.subtitle.y) < 40) state.dragging = 'subtitle';
            else if (Math.abs(mouseY - state.layers.title.y) < 40) state.dragging = 'title';
            else if (state.photoImg) state.dragging = 'photo';
        };

        window.onmousemove = e => {
            if (!state.dragging) return;
            const rect = canvas.getBoundingClientRect();
            const mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
            const mouseY = (e.clientY - rect.top) * (canvas.height / rect.height);

            state.layers[state.dragging].x = mouseX;
            state.layers[state.dragging].y = mouseY;
        };

        window.onmouseup = () => state.dragging = null;
    }

    init();
</script>

</body>
</html>
