<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Image Frame Tool ‚Äî 2025-12-30 20:23:45</title>
    <style>
        :root {
            --bg: #f4f4f9;
            --panel: #ffffff;
            --accent: #2563eb;
            --text: #1e293b;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        header {
            background: #fff;
            padding: 1rem 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { margin: 0; font-size: 1.25rem; }

        main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        #controls {
            width: 350px;
            background: var(--panel);
            border-right: 1px solid #ddd;
            padding: 1.5rem;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
        }

        #canvas-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: #e5e7eb;
            position: relative;
            cursor: grab;
        }

        #canvas-container:active { cursor: grabbing; }

        canvas {
            max-width: 100%;
            max-height: 100%;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            background: white;
        }

        .control-group {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }

        .control-group h3 {
            margin: 0 0 1rem 0;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
        }

        label { display: block; margin-bottom: 0.5rem; font-size: 0.85rem; font-weight: 600; }

        input[type="text"], select, input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 0.75rem;
            border: 1px solid #cbd5e1;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .flex-row { display: flex; gap: 10px; align-items: center; margin-bottom: 0.75rem; }
        .flex-row input { flex: 1; margin-bottom: 0; }

        button {
            cursor: pointer;
            padding: 0.6rem 1rem;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-primary { background: var(--accent); color: white; width: 100%; margin-top: 1rem; }
        .btn-primary:hover { background: #1d4ed8; }
        .btn-secondary { background: #64748b; color: white; flex: 1; font-size: 0.8rem; }

        .hint { font-size: 0.75rem; color: #94a3b8; margin-top: 0.5rem; }
    </style>
</head>
<body>

<header>
    <h1>AI Image Frame Tool ‚Äî 2025-12-30 20:23:45</h1>
    <button onclick="exportImage()" class="btn-primary" style="margin:0; width: auto;">Export PNG</button>
</header>

<main>
    <div id="controls">
        <div class="control-group">
            <h3>1. Image Source</h3>
            <input type="file" id="imageInput" accept="image/*">
            <label>Image Opacity (20-100%)</label>
            <input type="range" id="imgOpacity" min="0.2" max="1" step="0.01" value="1" style="width:100%">
        </div>

        <div class="control-group">
            <h3>2. Frame / Border</h3>
            <label>Border Color</label>
            <input type="color" id="borderColor" value="#000000" style="width:100%; height:40px;">
            <label>Thickness</label>
            <input type="range" id="borderWidth" min="0" max="200" value="40" style="width:100%">
        </div>

        <div class="control-group">
            <h3>3. Title Overlay</h3>
            <input type="text" id="titleText" placeholder="Enter Title..." value="Your Title Here">
            <div class="flex-row">
                <input type="color" id="titleColor" value="#ffffff">
                <input type="number" id="titleSize" min="14" max="800" value="60">
            </div>
            <select id="titleFont">
                <option value='"PingFang TC","PingFangTC-Regular","Heiti TC",sans-serif'>PingFang TCÔºàÁπÅÔºâ</option>
                <option value='"Heiti TC","Heiti TC Light",sans-serif'>Heiti TCÔºàÁπÅÔºâ</option>
                <option value='"Songti TC","Songti TC Regular",serif'>Songti TCÔºàÁπÅÔºâ</option>
                <option value='"Kaiti TC",serif'>Kaiti TCÔºàÁπÅÔºâ</option>
                <option value='system-ui, sans-serif'>System UI</option>
                <option value='Arial, sans-serif'>Arial</option>
                <option value='Helvetica, sans-serif'>Helvetica</option>
            </select>
        </div>

        <div class="control-group">
            <h3>4. Subtitle Overlay</h3>
            <input type="text" id="subText" placeholder="Enter Subtitle..." value="Sub-header text goes here">
            <div class="flex-row">
                <input type="color" id="subColor" value="#ffffff">
                <input type="number" id="subSize" min="14" max="800" value="30">
            </div>
            <select id="subFont">
                <option value='"PingFang TC","PingFangTC-Regular","Heiti TC",sans-serif'>PingFang TCÔºàÁπÅÔºâ</option>
                <option value='"Heiti TC","Heiti TC Light",sans-serif'>Heiti TCÔºàÁπÅÔºâ</option>
                <option value='"Songti TC","Songti TC Regular",serif'>Songti TCÔºàÁπÅÔºâ</option>
                <option value='"Kaiti TC",serif'>Kaiti TCÔºàÁπÅÔºâ</option>
                <option value='system-ui, sans-serif'>System UI</option>
                <option value='Arial, sans-serif'>Arial</option>
                <option value='Helvetica, sans-serif'>Helvetica</option>
            </select>
        </div>

        <div class="control-group">
            <h3>5. Styles</h3>
            <div class="flex-row">
                <button onclick="randomStyle()" class="btn-secondary">üé≤ Random Style</button>
                <button onclick="centerAll()" class="btn-secondary">üéØ Recenter</button>
            </div>
            <p class="hint">Tip: Drag items directly on the canvas to reposition.</p>
        </div>
    </div>

    <div id="canvas-container">
        <canvas id="mainCanvas"></canvas>
    </div>
</main>

<script>
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const imageInput = document.getElementById('imageInput');

    // State Management
    let img = new Image();
    let imgLoaded = false;
    
    let state = {
        imgPos: { x: 0, y: 0 },
        titlePos: { x: 0, y: 0 },
        subPos: { x: 0, y: 0 },
        dragTarget: null,
        isDragging: false,
        lastMouse: { x: 0, y: 0 }
    };

    const presets = [
        "Capture the Moment", "Stay Wild", "City Lights", "Nature's Whispers", 
        "Endless Summer", "The Art of Living", "Minimalist Soul"
    ];

    // Initialize
    window.onload = () => {
        canvas.width = 800;
        canvas.height = 600;
        draw();
    };

    // UI Listeners
    const inputs = ['titleText', 'titleColor', 'titleSize', 'titleFont', 
                    'subText', 'subColor', 'subSize', 'subFont', 
                    'borderColor', 'borderWidth', 'imgOpacity'];
    
    inputs.forEach(id => {
        document.getElementById(id).addEventListener('input', draw);
    });

    imageInput.addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                imgLoaded = true;
                centerAll();
                draw();
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    function centerAll() {
        state.imgPos = { x: 0, y: 0 };
        state.titlePos = { x: canvas.width / 2, y: canvas.height / 2 - 20 };
        state.subPos = { x: canvas.width / 2, y: canvas.height / 2 + 50 };
        
        // Smart sizing
        const baseSize = Math.min(canvas.width, canvas.height);
        document.getElementById('titleSize').value = Math.floor(baseSize * 0.08);
        document.getElementById('subSize').value = Math.floor(baseSize * 0.04);
        document.getElementById('borderWidth').value = Math.floor(baseSize * 0.05);
        draw();
    }

    function randomStyle() {
        const colors = ['#ffffff', '#000000', '#facc15', '#f87171', '#60a5fa', '#4ade80'];
        const fonts = document.getElementById('titleFont').options;
        
        document.getElementById('titleColor').value = colors[Math.floor(Math.random() * colors.length)];
        document.getElementById('subColor').value = colors[Math.floor(Math.random() * colors.length)];
        document.getElementById('titleFont').selectedIndex = Math.floor(Math.random() * fonts.length);
        document.getElementById('subFont').selectedIndex = Math.floor(Math.random() * fonts.length);
        document.getElementById('titleText').value = presets[Math.floor(Math.random() * presets.length)];
        draw();
    }

    // Drawing Logic
    function draw() {
        if (!ctx) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        const bWidth = parseInt(document.getElementById('borderWidth').value);
        const bColor = document.getElementById('borderColor').value;
        const opacity = parseFloat(document.getElementById('imgOpacity').value);

        // 1. Draw Image with opacity (Moved with frame)
        if (imgLoaded) {
            ctx.save();
            ctx.globalAlpha = opacity;
            ctx.drawImage(img, state.imgPos.x, state.imgPos.y);
            ctx.restore();
        }

        // 2. Draw Frame (Follows image position)
        if (bWidth > 0) {
            ctx.strokeStyle = bColor;
            ctx.lineWidth = bWidth * 2; // Drawn from center of line, so double for inner/outer overlap
            ctx.strokeRect(state.imgPos.x, state.imgPos.y, canvas.width, canvas.height);
        }

        // 3. Draw Title
        drawText(
            document.getElementById('titleText').value,
            state.titlePos.x,
            state.titlePos.y,
            document.getElementById('titleSize').value,
            document.getElementById('titleColor').value,
            document.getElementById('titleFont').value
        );

        // 4. Draw Subtitle
        drawText(
            document.getElementById('subText').value,
            state.subPos.x,
            state.subPos.y,
            document.getElementById('subSize').value,
            document.getElementById('subColor').value,
            document.getElementById('subFont').value
        );
    }

    function drawText(text, x, y, size, color, font) {
        ctx.save();
        ctx.font = `${size}pt ${font}`;
        ctx.fillStyle = color;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(text, x, y);
        ctx.restore();
    }

    // Interaction Logic
    function getCoords(e) {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;
        const clientY = e.touches ? e.touches[0].clientY : e.clientY;
        return {
            x: (clientX - rect.left) * scaleX,
            y: (clientY - rect.top) * scaleY
        };
    }

    function handleStart(e) {
        const coords = getCoords(e);
        state.isDragging = true;
        state.lastMouse = coords;

        // Hit Detection (Reverse order for layering)
        const subDist = Math.hypot(coords.x - state.subPos.x, coords.y - state.subPos.y);
        const titleDist = Math.hypot(coords.x - state.titlePos.x, coords.y - state.titlePos.y);

        if (subDist < 50) state.dragTarget = 'sub';
        else if (titleDist < 50) state.dragTarget = 'title';
        else state.dragTarget = 'image';
    }

    function handleMove(e) {
        if (!state.isDragging) return;
        e.preventDefault();
        const coords = getCoords(e);
        const dx = coords.x - state.lastMouse.x;
        const dy = coords.y - state.lastMouse.y;

        if (state.dragTarget === 'title') {
            state.titlePos.x += dx;
            state.titlePos.y += dy;
        } else if (state.dragTarget === 'sub') {
            state.subPos.x += dx;
            state.subPos.y += dy;
        } else if (state.dragTarget === 'image') {
            state.imgPos.x += dx;
            state.imgPos.y += dy;
        }

        state.lastMouse = coords;
        draw();
    }

    function handleEnd() {
        state.isDragging = false;
        state.dragTarget = null;
    }

    canvas.addEventListener('mousedown', handleStart);
    window.addEventListener('mousemove', handleMove);
    window.addEventListener('mouseup', handleEnd);

    canvas.addEventListener('touchstart', handleStart, {passive: false});
    window.addEventListener('touchmove', handleMove, {passive: false});
    window.addEventListener('touchend', handleEnd);

    function exportImage() {
        const link = document.createElement('a');
        link.download = `frame-export-${Date.now()}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
    }
</script>

</body>
</html>
